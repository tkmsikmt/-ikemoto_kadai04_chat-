<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <title>Firebase:v9:Chatã‚¢ãƒ—ãƒª</title>
  </head>
  <body>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

    <p>OBJECT/KEYRESULTS 2022 1Q</p>
    <div>
      <div>
        <select name="" id="uname">
          <option value="00">è©•ä¾¡è€…é¸æŠ</option>
          <option value="1">ãƒœã‚¹</option>
          <option value="2">éƒ¨ä¸‹</option>
        </select>
      </div>

      <!-- <div>åå‰ï¼š<input type="text" id="uname" /></div> -->

      <!-- <button id="send">é€ä¿¡</button> -->

      <select name="" id="self_1">
        <option value="00">è©•èªã€é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="4">S</option>
        <option value="3">A</option>
        <option value="2">B</option>
        <option value="1">C</option>
      </select>

      <!-- <select name="" id="boss_1">
        <option value="00">è‡ªå·±è©•èªã€é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="4">S</option>
        <option value="3">A</option>
        <option value="2">B</option>
        <option value="1">C</option>
      </select> -->

      <div>
        <textarea id="text" cols="15" rows="10"></textarea>
        <button id="send">é€ä¿¡</button>
      </div>

      <!-- <div>
        <textarea id="text1-2" cols="15" rows="10"></textarea>
        <button id="send1-2">é€ä¿¡</button>
      </div> -->
      <!-- <div id="btn">btn</div> -->
      <div id="output"></div>
      <div id="result">æ±ºå®šè©•èª</div>
      <!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

      <!-- ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’jsã§è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
    </div>

    <!-- ï¼‹ï¼‹ï¼‹ç›®æ¨™ï¼’ã¤ç›®ï¼‹ï¼‹ï¼‹ -->

    <div>
      <div>
        <select name="" id="uname2">
          <option value="00">è©•ä¾¡è€…é¸æŠ</option>
          <option value="1">ãƒœã‚¹</option>
          <option value="2">éƒ¨ä¸‹</option>
        </select>
      </div>

      <!-- <div>åå‰ï¼š<input type="text" id="uname" /></div> -->

      <!-- <button id="send">é€ä¿¡</button> -->

      <select name="" id="self_2">
        <option value="00">è©•èªã€é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="4">S</option>
        <option value="3">A</option>
        <option value="2">B</option>
        <option value="1">C</option>
      </select>

      <!-- <select name="" id="boss_1">
        <option value="00">è‡ªå·±è©•èªã€é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="4">S</option>
        <option value="3">A</option>
        <option value="2">B</option>
        <option value="1">C</option>
      </select> -->

      <div>
        <textarea id="text2" cols="15" rows="10"></textarea>
        <button id="send2">é€ä¿¡</button>
      </div>

      <!-- <div>
        <textarea id="text1-2" cols="15" rows="10"></textarea>
        <button id="send1-2">é€ä¿¡</button>
      </div> -->
      <!-- <div id="btn">btn</div> -->
      <div id="output2"></div>
      <div id="result2">æ±ºå®šè©•èª</div>
      <!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

      <!-- ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’jsã§è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
    </div>

    <!-- ï¼‹ï¼‹ï¼‹ç›®æ¨™3ã¤ç›®ï¼‹ï¼‹ï¼‹ -->

    <div>
      <div>
        <select name="" id="uname3">
          <option value="00">è©•ä¾¡è€…é¸æŠ</option>
          <option value="1">ãƒœã‚¹</option>
          <option value="2">éƒ¨ä¸‹</option>
        </select>
      </div>

      <!-- <div>åå‰ï¼š<input type="text" id="uname" /></div> -->

      <!-- <button id="send">é€ä¿¡</button> -->

      <select name="" id="self_3">
        <option value="00">è©•èªã€é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="4">S</option>
        <option value="3">A</option>
        <option value="2">B</option>
        <option value="1">C</option>
      </select>

      <!-- <select name="" id="boss_1">
        <option value="00">è‡ªå·±è©•èªã€é¸æŠã—ã¦ãã ã•ã„</option>
        <option value="4">S</option>
        <option value="3">A</option>
        <option value="2">B</option>
        <option value="1">C</option>
      </select> -->

      <div>
        <textarea id="text3" cols="15" rows="10"></textarea>
        <button id="send3">é€ä¿¡</button>
      </div>

      <!-- <div>
        <textarea id="text1-2" cols="15" rows="10"></textarea>
        <button id="send1-2">é€ä¿¡</button>
      </div> -->
      <!-- <div id="btn">btn</div> -->
      <div id="output3"></div>
      <div id="result3">æ±ºå®šè©•èª</div>
      <!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->

      <!-- ç™»éŒ²ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’jsã§è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
    </div>

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <!-- JQuery -->

    <!--** ä»¥ä¸‹Firebase **-->

    <!--** ä»¥ä¸‹Firebase **-->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
        set,
        onChildAdded,
        remove,
        onChildRemoved,
      } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
      // Your web app's Firebase configuration

      const firebaseConfig = {
  
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app); //RealtimeDBã«æ¥ç¶š

      const dbRef = ref(db, "chat"); //RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†
      const dbRef2 = ref(db, "chat2"); //RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†
      const dbRef3 = ref(db, "chat3"); //RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†
      //   console.log(dbRef )

      //   const evaluation= $("#self_1").val()
      //   const db_number = ref(db, `"chat"/${evaluation}`); //RealtimeDBå†…ã®"chat"ã®ä¸‹ã®éšå±¤ã‚’ä½¿ã†

      //é€ä¿¡ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰å‡¦ç†ã•ã‚Œã‚‹ï¼ˆç™»éŒ²ãŒï¼‰

      //   ++++1å›ç›®ã®ç›®æ¨™ã®firebaseå‡¦ç†+++
      $("#send").on("click", function () {
        alert(1);

        const uname = $("#uname").val();
        const text = $("#text").val();
        const j_hyouka1 = $("#self_1").val();

        console.log(uname, "åå‰");
        console.log(text, "ãƒ†ã‚­ã‚¹ãƒˆ");
        console.log(j_hyouka1, "è‡ªå·±è©•ä¾¡ï¼‘");

        const msg = {
          uname: uname,
          text: text,
          j_hyouka1: j_hyouka1,
        };

        const newPostRef = push(dbRef);
        set(newPostRef, msg);

        //ãƒ–ãƒ©ãƒ³ã‚¯ã‚’å…¥åŠ›ã•ã›ã‚‹ï¼ˆæ–‡å­—æ¶ˆã™ï¼‰
        // $("#uname").val("");
        $("#text").val("");

        //ã“ã®ä¸‹ã¯æ¶ˆã•ãªã„
      });

      var sum_number = 0;
      var count_number = 0;

      // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ğŸ¤—
      onChildAdded(dbRef, function (data) {
        const msg = data.val();
        // console.log(msg, "dataã‚’å—ä¿¡");
        const kagi = data.key;
        // console.log(kagi, "éµ");

        const hyouka = msg.j_hyouka1;
        // console.log(hyouka, "è©•ä¾¡ç‚¹");

        var hyouka_num = parseInt(hyouka);
        // console.log(typeof hyouka_num);

        const name = msg.uname;

        if (msg.uname == "1") {
          console.log(msg.j_hyouka1);
          var name_value = "ãƒœã‚¹";
          sum_number += parseInt(msg.j_hyouka1);
          console.log(sum_number);

          count_number += 1;
          console.log(count_number);
        }

        if (msg.uname == "2") {
          console.log(msg.j_hyouka1);
          var name_value = "éƒ¨ä¸‹";
          sum_number += parseInt(msg.j_hyouka1);
          console.log(sum_number);

          count_number += 1;
          console.log(count_number);
        }
        // console.log(sum_number)
        // console.log(count_number)

        // console.log(ave_number)

        let html = `
        <div class="${kagi}">
           <table border="1" width=300px>
            <tr>
            <td width=100px>${name_value}</td>
            <td width=100px>${msg.text}</td>
            <td width=100px>${hyouka_num}</td>
            </tr>
            </table>
        </div>
          `;

        //   let html = `
        //     <p>${msg.uname}</p>
        //     <p>${msg.text}</p>
        //     <p>${msg.j_hyouka1}</p>
        //   `;
        // console.log(html)

        $("#output").append(html);

        if (count_number >= 2) {
          var ave_number = sum_number / count_number;
          var result_number = ave_number;

          console.log(count_number);
          $("#result").append(result_number);
          console.log(result_number);
        }
      });

      //   ++++2å›ç›®ã®ç›®æ¨™ã®firebaseå‡¦ç†+++
      $("#send2").on("click", function () {
        alert(2);

        const uname2 = $("#uname2").val();
        const text2 = $("#text2").val();
        const j_hyouka2 = $("#self_2").val();

        console.log(uname2, "åå‰");
        console.log(text2, "ãƒ†ã‚­ã‚¹ãƒˆ");
        console.log(j_hyouka2, "è‡ªå·±è©•ä¾¡2");

        const msg2 = {
          uname2: uname2,
          text2: text2,
          j_hyouka2: j_hyouka2,
        };

        const newPostRef2 = push(dbRef2);
        set(newPostRef2, msg2);

        //ãƒ–ãƒ©ãƒ³ã‚¯ã‚’å…¥åŠ›ã•ã›ã‚‹ï¼ˆæ–‡å­—æ¶ˆã™ï¼‰
        $("#text2").val("");

        //ã“ã®ä¸‹ã¯æ¶ˆã•ãªã„
      });

      var sum_number2 = 0;
      var count_number2 = 0;

      // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ğŸ¤—
      onChildAdded(dbRef2, function (data2) {
        const msg2 = data2.val();
        console.log(msg2, "dataã‚’å—ä¿¡");
        const kagi2 = data2.key;
        console.log(kagi2, "éµ2");

        const hyouka2 = msg2.j_hyouka2;
        console.log(hyouka2, "è©•ä¾¡ç‚¹");

        var hyouka_num2 = parseInt(hyouka2);
        console.log(typeof hyouka_num2);

        const name2 = msg2.uname2;

        if (msg2.uname2 == "1") {
          console.log(msg2.j_hyouka2);
          var name_value2 = "ãƒœã‚¹";
          sum_number2 += parseInt(msg2.j_hyouka2);
          console.log(sum_number2);

          count_number2 += 1;
          console.log(count_number2);
        }

        if (msg2.uname2 == "2") {
          console.log(msg2.j_hyouka2);
          var name_value2 = "éƒ¨ä¸‹";
          sum_number2 += parseInt(msg2.j_hyouka2);
          console.log(sum_number2);

          count_number2 += 1;
          console.log(count_number2);
        }

        let html2 = `
           <table border="1" width=300px>
            <tr>
            <td width=100px>${name_value2}</td>
            <td width=100px>${msg2.text2}</td>
            <td width=100px>${hyouka_num2}</td>
            </tr>
            </table>
          `;

        $("#output2").append(html2);

        if (count_number2 >= 2) {
          var ave_number2 = sum_number2 / count_number2;
          var result_number2 = ave_number2;

          console.log(count_number2);
          $("#result2").append(result_number2);
          console.log(result_number2);
        }
      });

      // //   ++++3å›ç›®ã®ç›®æ¨™ã®firebaseå‡¦ç†+++

      $("#send3").on("click", function () {
        alert(3);

        const uname3 = $("#uname3").val();
        const text3 = $("#text3").val();
        const j_hyouka3 = $("#self_3").val();

        console.log(uname3, "åå‰");
        console.log(text3, "ãƒ†ã‚­ã‚¹ãƒˆ");
        console.log(j_hyouka3, "è‡ªå·±è©•ä¾¡3");

        const msg3 = {
          uname3: uname3,
          text3: text3,
          j_hyouka3: j_hyouka3,
        };

        const newPostRef3 = push(dbRef3);
        set(newPostRef3, msg3);

        //ãƒ–ãƒ©ãƒ³ã‚¯ã‚’å…¥åŠ›ã•ã›ã‚‹ï¼ˆæ–‡å­—æ¶ˆã™ï¼‰
        $("#text3").val("");

        //ã“ã®ä¸‹ã¯æ¶ˆã•ãªã„
      });

      var sum_number3 = 0;
      var count_number3 = 0;

      // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ğŸ¤—
      onChildAdded(dbRef3, function (data3) {
        const msg3 = data3.val();
        console.log(msg3, "dataã‚’å—ä¿¡");
        const kagi3 = data3.key;
        console.log(kagi3, "éµ3");

        const hyouka3 = msg3.j_hyouka3;
        console.log(hyouka3, "è©•ä¾¡ç‚¹");

        var hyouka_num3 = parseInt(hyouka3);
        console.log(typeof hyouka_num3);

        const name3 = msg3.uname3;

        if (msg3.uname3 == "1") {
          console.log(msg3.j_hyouka3);
          var name_value3 = "ãƒœã‚¹";
          sum_number3 += parseInt(msg3.j_hyouka3);
          console.log(sum_number3);

          count_number3 += 1;
          console.log(count_number3);
        }

        if (msg3.uname3 == "2") {
          console.log(msg3.j_hyouka3);
          var name_value3 = "éƒ¨ä¸‹";
          sum_number3 += parseInt(msg3.j_hyouka3);
          console.log(sum_number3);

          count_number3 += 1;
          console.log(count_number3);
        }

        let html3 = `
           <table border="1" width=300px>
            <tr>
            <td width=100px>${name_value3}</td>
            <td width=100px>${msg3.text3}</td>
            <td width=100px>${hyouka_num3}</td>
            </tr>
            </table>
          `;

        $("#output3").append(html3);

        if (count_number3 >= 2) {
          var ave_number3 = sum_number3 / count_number3;
          var result_number3 = ave_number3;

          console.log(count_number3);
          $("#result3").append(result_number3);
          console.log(result_number3);
        }
      });

      // $("#send").on("click", function () {
      //     alert(1);

      //     const uname = $("#uname").val();
      //     const text = $("#text").val();
      //     const j_hyouka1 = $("#self_1").val();

      //     console.log(uname,'åå‰')
      //     console.log(text,'ãƒ†ã‚­ã‚¹ãƒˆ')
      //     console.log(j_hyouka1,"è‡ªå·±è©•ä¾¡ï¼‘")

      //     const msg = {
      //       uname: uname,
      //       text: text,
      //       j_hyouka1: j_hyouka1,
      //     };

      //     const newPostRef = push(dbRef);
      //     set(newPostRef, msg);

      //     //ãƒ–ãƒ©ãƒ³ã‚¯ã‚’å…¥åŠ›ã•ã›ã‚‹ï¼ˆæ–‡å­—æ¶ˆã™ï¼‰
      //     $("#text").val("");

      //     //ã“ã®ä¸‹ã¯æ¶ˆã•ãªã„
      //   });

      //   // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ğŸ¤—
      //   onChildAdded(dbRef, function (data) {
      //     const msg = data.val();
      //     console.log(msg, "dataã‚’å—ä¿¡");

      //     const hyouka = msg.j_hyouka1;
      //     console.log(hyouka, "è©•ä¾¡ç‚¹");

      //     var hyouka_num = parseInt(hyouka);
      //     console.log(typeof hyouka_num);

      //     const name = msg.uname

      //     if(name=="1"){
      //         var name_value= "ãƒœã‚¹"
      //         console.log(name_value)
      //     }

      //     if(name=="2"){
      //         var name_value= "éƒ¨ä¸‹"
      //         console.log(name_value)
      //     }

      //     let html = `
      //        <table border="1" width=300px>
      //         <tr>
      //         <td width=100px>${name_value}</td>
      //         <td width=100px>${msg.text}</td>
      //         <td width=100px>${hyouka_num}</td>
      //         </tr>
      //         </table>
      //       `;

      //     $("#output3").append(html);
      //   });
    </script>
  </body>
</html>
